<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form id="formFuncionario">
        <label for="nome">Nome:</label>
        <input id="nome" type="text" name="nome" required><br>

        <label for="cpf">CPF:</label>
        <input id="cpf" type="text" name="cpf" required><br>

        <label for="email">Email:</label>
        <input id="email" type="email" name="email" required><br>

        <label for="salario">Salário:</label>
        <input id="salario" type="number" step="0.01" name="salario"><br>

        <label for="ativo">Ativo:</label>
        <input id="ativo" type="checkbox" name="ativo"><br>

        <label for="pais">País:</label>
        <input id="pais" type="text" name="pais" required><br>

        <label for="estado">Estado:</label>
        <input id="estado" type="text" name="estado" maxlength="2" required><br>

        <label for="cidade">Cidade:</label>
        <input id="cidade" type="text" name="cidade" required><br>

        <label for="bairro">Bairro:</label>
        <input id="bairro" type="text" name="bairro" required><br>

        <label for="logradouro">Logradouro:</label>
        <input id="logradouro" type="text" name="logradouro" required><br>

        <label for="numero">Número:</label>
        <input id="numero" type="text" name="numero"><br>

        <label for="cep">CEP:</label>
        <input id="cep" type="text" name="cep"><br>


        <label for="departamentos">Departamento:</label>
        <select name="idDepartamento" id="departamentos" required>
            <option value="">Selecione...</option>
        </select>
        <br>


        <!--  
        <label for="idDepartamento">ID do Departamento:</label>
        <input id="idDepartamento" type="number" name="idDepartamento" required><br>
        -->
        <button type="submit">Cadastrar</button>
    </form>



    <script>
        async function carregarDepartamentos() {
            try {
                const response = await fetch('http://localhost:8080/departamentos');
                if (!response.ok) throw new Error('Erro ao buscar departamentos');

                const departamentos = await response.json();
                const select = document.getElementById('departamentos');

                departamentos.forEach(dep => {
                    const option = document.createElement('option');
                    option.value = dep.idDepartamento;
                    option.textContent = dep.nmDepartamento;
                    select.appendChild(option);
                });
            } catch (error) {
                alert('Erro ao carregar departamentos: ' + error.message);
            }
        }

        carregarDepartamentos();
    </script>



    <script>
        document.getElementById('formFuncionario').addEventListener('submit', async function (e) {
            e.preventDefault();

            const form = e.target;

            const funcionario = {
                nome: form.nome.value,
                cpf: form.cpf.value,
                email: form.email.value,
                salario: parseFloat(form.salario.value) || 0,
                ativo: form.ativo.checked,
                endereco: {
                    pais: form.pais.value,
                    estado: form.estado.value,
                    cidade: form.cidade.value,
                    bairro: form.bairro.value,
                    logradouro: form.logradouro.value,
                    numero: form.numero.value,
                    cep: form.cep.value
                },
                idDepartamento: {
                    idDepartamento: parseInt(form.idDepartamento.value)
                }
            };

            try {
                const response = await fetch('http://localhost:8080/funcionarios', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(funcionario)
                });

                if (response.ok) {
                    alert('Funcionário cadastrado com sucesso!');
                    form.reset();
                } else {
                    const errorText = await response.text();
                    alert('Erro ao cadastrar: ' + errorText);
                }
            } catch (error) {
                alert('Erro de rede: ' + error.message);
            }
        });

    </script>

</body>

</html>